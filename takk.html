<!doctype html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Husholdningsbudsjett - Ferdig!</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body{
      box-sizing:border-box;margin:0;padding:0;height:100%;
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      background:linear-gradient(135deg,#f8fffe 0%,#f0f9f4 100%);
      display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;
    }
    html{height:100%;}

    /* KONFETTI â€“ start fra toppen */
    .confetti{
      position:absolute;top:-16px; /* <- start over toppen */
      width:10px;height:10px;background:#4caf50;animation:confetti-fall linear infinite;
    }
    .confetti:nth-child(odd){background:#81c784;border-radius:50%;}
    .confetti:nth-child(3n){background:#a5d6a7;width:8px;height:8px;}
    .confetti:nth-child(4n){background:#c8e6c9;border-radius:50%;width:6px;height:6px;}
    @keyframes confetti-fall{
      0%{transform:translateY(0) rotate(0deg);opacity:1;}
      100%{transform:translateY(calc(100vh + 40px)) rotate(360deg);opacity:0;}
    }

    .container{width:90%;max-width:700px;text-align:center;padding:40px;position:relative;z-index:10;}
    .celebration-icon{margin-bottom:32px;animation:fadeInDown .8s ease-out;}
    .heart-icon{font-size:120px;color:#4caf50;animation:heartPulse 2s ease-in-out infinite;display:inline-block;}

    .header{margin-bottom:18px;animation:fadeInUp .8s ease-out .2s both;}
    .title{font-size:48px;font-weight:800;color:#2d5f4d;margin-bottom:16px;line-height:1.2;animation:titleBounce .8s ease-out .4s both;}
    .description{font-size:20px;color:#5a7a6d;line-height:1.6;max-width:550px;margin:0 auto;}

    /* Badge FLYTTET under header */
    .success-badge{
      display:inline-flex;align-items:center;gap:10px;background:rgba(76,175,80,.1);
      color:#2d5f4d;padding:12px 20px;border-radius:50px;font-size:16px;font-weight:600;
      margin:14px 0 34px;animation:fadeInUp .8s ease-out .35s both;
    }
    .checkmark{width:20px;height:20px;background:#4caf50;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:bold;}

    .button-section{margin-top:36px;animation:fadeInUp .8s ease-out .6s both;}
    .start-button{
      background:linear-gradient(135deg,#4caf50 0%,#45a049 100%);color:#fff;border:none;
      padding:25px 70px;font-size:26px;font-weight:700;border-radius:50px;cursor:pointer;
      box-shadow:0 10px 25px rgba(76,175,80,.4);transition:all .3s ease;margin-bottom:20px;position:relative;overflow:hidden;
    }
    .start-button::before{
      content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:left .5s;
    }
    .start-button:hover::before{left:100%;}
    .start-button:hover{transform:translateY(-4px);box-shadow:0 15px 35px rgba(76,175,80,.5);background:linear-gradient(135deg,#45a049 0%,#3d8b40 100%);}
    .start-button:active{transform:translateY(-2px);box-shadow:0 8px 20px rgba(76,175,80,.4);}

    .back-button{
      background:transparent;color:#8a9a8d;border:2px solid #e0e7e3;
      padding:15px 40px;font-size:18px;font-weight:500;border-radius:30px;cursor:pointer;transition:all .3s ease;
    }
    .back-button:hover{background:#f5f8f6;border-color:#c8d4cb;color:#5a7a6d;}

    @keyframes fadeInDown{from{opacity:0;transform:translateY(-30px);}to{opacity:1;transform:translateY(0);}}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
    @keyframes titleBounce{0%{opacity:0;transform:scale(.8);}50%{transform:scale(1.05);}100%{opacity:1;transform:scale(1);}}
    @keyframes heartPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}

    @media (max-width:768px){
      .heart-icon{font-size:80px;}
      .title{font-size:36px;}
      .description{font-size:18px;}
      .start-button{font-size:22px;padding:20px 50px;}
    }
  </style>
  <style>@view-transition{navigation:auto;}</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
  <main class="container">
    <div class="celebration-icon"><div class="heart-icon">ðŸ’š</div></div>

    <div class="header">
      <h1 class="title" id="mainTitle">Alt er klart!</h1>
      <p class="description" id="descriptionText">
        Flott! Dere har nÃ¥ satt opp husholdningsbudsjettet.<br>
        Appen hjelper dere Ã¥ holde oversikt gjennom uka â€“ steg for steg.
      </p>
    </div>

    <!-- Badge under tittel/tekst -->
    <div class="success-badge" id="successBadge">
      <div class="checkmark">âœ“</div> Onboarding fullfÃ¸rt
    </div>

    <div class="button-section">
      <button class="start-button" id="startButton">Start uke 1</button><br>
      <button class="back-button" id="backButton">Tilbake</button>
    </div>
  </main>

  <script>
    const defaultConfig = {
      background_color:"#f8fffe",surface_color:"#ffffff",text_color:"#2d5f4d",
      primary_action_color:"#4caf50",secondary_text_color:"#5a7a6d",
      font_family:"Inter",font_size:20,
      main_title:"Alt er klart!",
      description_text:"Flott! Dere har nÃ¥ satt opp husholdningsbudsjettet.\nAppen hjelper dere Ã¥ holde oversikt gjennom uka â€“ steg for steg.",
      start_button_text:"Start uke 1",back_button_text:"Tilbake"
    };

    const onboardingState = {
      householdCount: localStorage.getItem('householdCount'),
      weeklyBudget: localStorage.getItem('weeklyBudget'),
      trackingScope: localStorage.getItem('trackingScope')
    };

    async function onConfigChange(config){
      const bg = config.background_color||defaultConfig.background_color;
      const surf = config.surface_color||defaultConfig.surface_color;
      const txt = config.text_color||defaultConfig.text_color;
      const pri = config.primary_action_color||defaultConfig.primary_action_color;
      const sec = config.secondary_text_color||defaultConfig.secondary_text_color;
      const font = config.font_family||defaultConfig.font_family;
      const base = config.font_size||defaultConfig.font_size;

      document.body.style.background = `linear-gradient(135deg, ${bg} 0%, ${adjustColor(bg,-2)} 100%)`;

      const title=document.getElementById('mainTitle');
      title.textContent = config.main_title||defaultConfig.main_title;
      title.style.color = txt;
      title.style.fontFamily = `${font}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      title.style.fontSize = `${base*2.4}px`;

      const desc=document.getElementById('descriptionText');
      desc.innerHTML = (config.description_text||defaultConfig.description_text).replace(/\n/g,'<br>');
      desc.style.color = sec;
      desc.style.fontFamily = `${font}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      desc.style.fontSize = `${base}px`;

      const start=document.getElementById('startButton');
      start.textContent = config.start_button_text||defaultConfig.start_button_text;
      start.style.fontFamily = `${font}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      start.style.fontSize = `${base*1.3}px`;
      start.style.background = `linear-gradient(135deg, ${pri} 0%, ${adjustColor(pri,-10)} 100%)`;

      const back=document.getElementById('backButton');
      back.textContent = config.back_button_text||defaultConfig.back_button_text;
      back.style.fontFamily = `${font}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;

      document.querySelector('.heart-icon').style.color = pri;
      const badge=document.getElementById('successBadge');
      badge.style.background = `${pri}1a`;
      badge.style.color = txt;
      document.querySelector('.checkmark').style.background = pri;

      updateConfettiColors(pri);
    }

    function adjustColor(color,percent){
      const num=parseInt(color.replace('#',''),16),amt=Math.round(2.55*percent);
      const R=Math.max(0,Math.min(255,(num>>16)+amt));
      const G=Math.max(0,Math.min(255,((num>>8)&0x00FF)+amt));
      const B=Math.max(0,Math.min(255,((num)&0x0000FF)+amt));
      return '#'+(0x1000000+R*0x10000+G*0x100+B).toString(16).slice(1);
    }

    function updateConfettiColors(primary){
      const s=document.createElement('style');
      s.textContent = `
        .confetti{background:${primary}!important;}
        .confetti:nth-child(odd){background:${adjustColor(primary,20)}!important;}
        .confetti:nth-child(3n){background:${adjustColor(primary,40)}!important;}
        .confetti:nth-child(4n){background:${adjustColor(primary,60)}!important;}
      `;
      document.head.appendChild(s);
    }

    function createConfetti(){
      for(let i=0;i<50;i++){
        const c=document.createElement('div');
        c.className='confetti';
        c.style.left = Math.random()*100 + '%';
        c.style.animationDuration = (Math.random()*3+2)+'s';
        c.style.animationDelay = (Math.random()*2)+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(), 6000);
      }
    }

    function mapToCapabilities(config){
      return {
        recolorables:[
          {get:()=>config.background_color||defaultConfig.background_color,set:v=>window.elementSdk?.setConfig({background_color:v})},
          {get:()=>config.surface_color||defaultConfig.surface_color,set:v=>window.elementSdk?.setConfig({surface_color:v})},
          {get:()=>config.text_color||defaultConfig.text_color,set:v=>window.elementSdk?.setConfig({text_color:v})},
          {get:()=>config.primary_action_color||defaultConfig.primary_action_color,set:v=>window.elementSdk?.setConfig({primary_action_color:v})},
          {get:()=>config.secondary_text_color||defaultConfig.secondary_text_color,set:v=>window.elementSdk?.setConfig({secondary_text_color:v})},
        ],
        borderables:[],
        fontEditable:{get:()=>config.font_family||defaultConfig.font_family,set:v=>window.elementSdk?.setConfig({font_family:v})},
        fontSizeable:{get:()=>config.font_size||defaultConfig.font_size,set:v=>window.elementSdk?.setConfig({font_size:v})}
      };
    }

    function mapToEditPanelValues(config){
      return new Map([
        ['main_title',config.main_title||defaultConfig.main_title],
        ['description_text',config.description_text||defaultConfig.description_text],
        ['start_button_text',config.start_button_text||defaultConfig.start_button_text],
        ['back_button_text',config.back_button_text||defaultConfig.back_button_text],
      ]);
    }

    // Navigasjon
    document.getElementById('startButton').addEventListener('click',()=>{
      const b=document.getElementById('startButton'); b.style.transform='scale(0.95)';
      setTimeout(()=>{ b.style.transform=''; localStorage.setItem('setupComplete','true'); location.href='app.html'; },150);
    });
    document.getElementById('backButton').addEventListener('click',()=>{
      const b=document.getElementById('backButton'); b.style.transform='scale(0.95)';
      setTimeout(()=>{ b.style.transform=''; location.href='onboarding3.html'; },150);
    });

    // Konfetti
    setTimeout(createConfetti, 300);
    const confettiInterval=setInterval(createConfetti, 3000);
    window.addEventListener('beforeunload',()=>clearInterval(confettiInterval));

    if(window.elementSdk){
      window.elementSdk.init({defaultConfig,onConfigChange,mapToCapabilities,mapToEditPanelValues});
    }
  </script>

  <!-- Canva/Cloudflare snippet beholdt -->
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99be7d563668b4f7',t:'MTc2MjcwMzY3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>

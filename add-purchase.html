<!doctype html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Legg til kj√∏p - Husholdningsbudsjett</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body { box-sizing:border-box; margin:0; padding:0; height:100%; font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:linear-gradient(135deg,#f8fffe 0%,#f0f9f4 100%); display:flex; align-items:center; justify-content:center; }
    html { height:100%; }
    .container { width:90%; max-width:600px; padding:40px; background:white; border-radius:25px; box-shadow:0 10px 30px rgba(0,0,0,0.1); animation:slideInUp .6s ease-out; }
    .header { text-align:center; margin-bottom:40px; animation:fadeInDown .8s ease-out; }
    .title { font-size:32px; font-weight:700; color:#2d5f4d; margin-bottom:15px; line-height:1.3; }
    .description { font-size:18px; color:#5a7a6d; line-height:1.5; }

    .form-section { margin-bottom:40px; animation:fadeInUp .8s ease-out .2s both; }
    .form-group { margin-bottom:22px; }
    .form-label { display:flex; align-items:center; gap:10px; font-size:18px; font-weight:600; color:#2d5f4d; margin-bottom:10px; }
    .form-icon { font-size:22px; }
    .form-input { width:100%; padding:20px 25px; font-size:20px; border:3px solid #e8f5f0; border-radius:15px; background:#fafffe; color:#2d5f4d; font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; transition:all .3s ease; box-sizing:border-box; }
    .form-input:focus { outline:none; border-color:#4caf50; background:white; box-shadow:0 0 0 4px rgba(76,175,80,.1); }
    .form-select { appearance:none; background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%235a7a6d' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e"); background-position:right 20px center; background-repeat:no-repeat; background-size:16px; padding-right:50px; }

    .store-chips { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
    .chip { padding:8px 14px; border:2px solid #e8f5f0; border-radius:999px; background:#fafffe; color:#2d5f4d; font-weight:600; font-size:14px; cursor:pointer; transition:all .2s; }
    .chip:hover { border-color:#4caf50; }
    .chip.active { background:#4caf50; color:#fff; border-color:#4caf50; }

    .amount-input { position:relative; }
    .amount-input::after { content:'kr'; position:absolute; right:25px; top:50%; transform:translateY(-50%); font-size:20px; color:#5a7a6d; font-weight:600; pointer-events:none; }
    .amount-input input { padding-right:60px; text-align:right; }
    .input-hint { margin-top:8px; font-size:14px; color:#5a7a6d; }

    .hint-row { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .hint-pill { padding:6px 10px; border-radius:10px; font-weight:600; font-size:12px; }
    .pill-ok { background:#e8f5ee; color:#2d5f4d; }
    .pill-warn { background:#fff6e5; color:#8a6d1a; }
    .pill-over { background:#ffe8e6; color:#9d1c1c; }

    .budget-hint { font-size:14px; margin-top:8px; }
    .budget-ok { color:#2d5f4d; }
    .budget-warn { color:#996c0b; }
    .budget-over { color:#b11f1f; }

    .week-hint { font-size:14px; margin-top:8px; color:#5a7a6d; }
    .week-hint.warn { color:#b56100; }

    .date-input { max-width:220px; }

    .button-section { text-align:center; animation:fadeInUp .8s ease-out .4s both; margin-top:10px; }
    .save-button { background:linear-gradient(135deg,#4caf50 0%,#45a049 100%); color:white; border:none; padding:25px 60px; font-size:22px; font-weight:700; border-radius:50px; cursor:pointer; box-shadow:0 8px 20px rgba(76,175,80,.3); transition:all .3s ease; margin-bottom:16px; position:relative; overflow:hidden; }
    .save-button:hover { transform:translateY(-3px); box-shadow:0 12px 28px rgba(76,175,80,.4); background:linear-gradient(135deg,#45a049 0%,#3d8b40 100%); }
    .save-button:active { transform:translateY(-1px); }
    .save-button.saving { background:#81c784; transform:scale(0.96); pointer-events:none; }
    .back-button { background:transparent; color:#8a9a8d; border:2px solid #e0e7e3; padding:16px 40px; font-size:18px; font-weight:500; border-radius:30px; cursor:pointer; transition:all .3s ease; }
    .back-button:hover { background:#f5f8f6; border-color:#c8d4cb; color:#5a7a6d; }

    /* Snackbar (Angre) */
    .snackbar { position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#2d2d2d; color:#fff; padding:14px 16px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.25); display:flex; align-items:center; gap:12px; z-index:999; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s; }
    .snackbar.show { opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0); }
    .snackbar .msg { font-size:14px; }
    .snackbar button { background:#ffffff18; color:#fff; border:none; padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer; }
    .snackbar button:hover { background:#ffffff28; }

    @keyframes slideInUp { from{opacity:0; transform:translateY(50px);} to{opacity:1; transform:translateY(0);} }
    @keyframes fadeInDown { from{opacity:0; transform:translateY(-30px);} to{opacity:1; transform:translateY(0);} }
    @keyframes fadeInUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }

    @media (max-width:768px){
      .container{padding:30px 25px;}
      .title{font-size:28px;}
      .description{font-size:16px;}
      .form-input{padding:18px 20px; font-size:18px;}
      .save-button{font-size:20px; padding:22px 50px;}
      .date-input{max-width:100%;}
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
  <main class="container">
    <div class="header">
      <h1 class="title" id="mainTitle">Legg til nytt kj√∏p</h1>
      <p class="description" id="descriptionText">Registrer hvor mye du brukte, og hvor du handlet.</p>
    </div>

    <form class="form-section" id="purchaseForm">
      <!-- Husk butikk + chips -->
      <div class="form-group">
        <label class="form-label" for="storeInput">
          <span class="form-icon">üè™</span> <span id="storeLabel">Butikk</span>
        </label>
        <div class="store-chips" id="storeChips" aria-label="Hyppigst brukt"></div>
        <select class="form-input form-select" id="storeInput" required>
          <option value="">Velg butikk...</option>
          <option value="Kiwi">Kiwi</option>
          <option value="Rema 1000">Rema 1000</option>
          <option value="Meny">Meny</option>
          <option value="Coop Extra">Coop Extra</option>
          <option value="ICA">ICA</option>
          <option value="Bunnpris">Bunnpris</option>
          <option value="Joker">Joker</option>
          <option value="Spar">Spar</option>
          <option value="Annet">Annet</option>
        </select>
      </div>

      <!-- Bel√∏p + budsjettvarsel -->
      <div class="form-group">
        <label class="form-label" for="amountInput">
          <span class="form-icon">üí∏</span> <span id="amountLabel">Bel√∏p</span>
        </label>
        <div class="amount-input">
          <!-- Tekst-input for √• kunne vise 453,90 -->
          <input type="text" class="form-input" id="amountInput" placeholder="0" inputmode="decimal" autocomplete="off">
        </div>
        <div id="budgetHint" class="budget-hint"></div>
      </div>

      <!-- Dato + uke-infotekst -->
      <div class="form-group">
        <label class="form-label" for="dateInput">
          <span class="form-icon">üìÖ</span> <span id="dateLabel">Dato</span>
        </label>
        <input type="date" class="form-input date-input" id="dateInput" required>
        <div id="weekHint" class="week-hint"></div>
      </div>
    </form>

    <div class="button-section">
      <button type="submit" class="save-button" id="saveButton" form="purchaseForm">
        <span id="saveButtonText">Lagre kj√∏p</span>
      </button><br>
      <button type="button" class="back-button" id="backButton">
        <span id="backButtonText">Tilbake til oversikten</span>
      </button>
    </div>
  </main>

  <!-- Snackbar (Angre) -->
  <div class="snackbar" id="snackbar" role="status" aria-live="polite">
    <span class="msg" id="snackbarMsg">Kj√∏p lagret</span>
    <button id="undoBtn">Angre</button>
    <button id="gotoBtn">Til oversikten</button>
  </div>

<script>
  const defaultConfig = {
    background_color: "#f8fffe",
    surface_color: "#ffffff",
    text_color: "#2d5f4d",
    primary_action_color: "#4caf50",
    secondary_text_color: "#5a7a6d",
    font_family: "Inter",
    font_size: 18,
    main_title: "Legg til nytt kj√∏p",
    description_text: "Registrer hvor mye du brukte, og hvor du handlet.",
    store_label: "Butikk",
    amount_label: "Bel√∏p",
    date_label: "Dato",
    save_button_text: "Lagre kj√∏p",
    back_button_text: "Tilbake til oversikten",
  };

  /* ======================
     Dato / uke-hjelpere
     ====================== */
  function isoLocalToday(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  function dateFromISOLocal(iso){
    const [y,m,d] = iso.split('-').map(Number);
    return new Date(y, m-1, d);
  }
  function mondayOfLocal(date){
    const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    const day = (d.getDay()+6)%7; // 0=mandag
    d.setDate(d.getDate()-day);
    d.setHours(12,0,0,0);
    return d;
  }
  function getActiveWeekISO(){
    return localStorage.getItem('activeWeekISO') || mondayOfLocal(new Date()).toISOString().slice(0,10);
  }
  function isoWeekNumber(date = new Date()) {
    const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
    const dayNum = d.getUTCDay() || 7;
    d.setUTCDate(d.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
    return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
  }
  function formatRangeNoNO(fromDate, toDate) {
    const optsDayMonth = { day:'numeric', month:'long' };
    const optsDay = { day:'numeric' };
    const from = fromDate.toLocaleDateString('no-NO', optsDayMonth);
    const to = toDate.toLocaleDateString('no-NO', (fromDate.getMonth()===toDate.getMonth()? optsDay : optsDayMonth));
    return `${from}‚Äì${to}`;
  }

  /* ======================
     Butikk-minne (chips)
     ====================== */
  const STORE_COUNTS_KEY = 'storeCounts';
  const LAST_STORE_KEY = 'lastStore';

  function getStoreCounts(){
    try { const obj = JSON.parse(localStorage.getItem(STORE_COUNTS_KEY)||'{}'); return obj && typeof obj==='object' ? obj : {}; }
    catch { return {}; }
  }
  function setStoreCounts(obj){
    localStorage.setItem(STORE_COUNTS_KEY, JSON.stringify(obj||{}));
  }
  function incStoreCount(name){
    if (!name) return;
    const counts = getStoreCounts();
    counts[name] = (counts[name]||0)+1;
    setStoreCounts(counts);
    localStorage.setItem(LAST_STORE_KEY, name);
  }
  function renderStoreChips(){
    const chips = document.getElementById('storeChips');
    const select = document.getElementById('storeInput');
    const counts = getStoreCounts();
    // Lag en liste over valgbare butikker fra select (uten f√∏rste placeholder)
    const options = Array.from(select.options).slice(1).map(o=>o.value);
    // sorter etter count desc, s√• navn
    const top = options.sort((a,b)=>(counts[b]||0)-(counts[a]||0) || a.localeCompare(b)).slice(0,3);
    chips.innerHTML = '';
    top.forEach(name=>{
      const div = document.createElement('div');
      div.className = 'chip';
      div.textContent = name;
      if (localStorage.getItem(LAST_STORE_KEY) === name) div.classList.add('active');
      div.addEventListener('click', ()=>{
        select.value = name;
        localStorage.setItem(LAST_STORE_KEY, name);
        chips.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        div.classList.add('active');
      });
      chips.appendChild(div);
    });
  }

  /* ======================
     Budsjettberegning
     ====================== */
  function readWeeklyBudgetFor(isoMonday){
    const byWeek = parseFloat(localStorage.getItem(`weeklyBudget_${isoMonday}`));
    if (Number.isFinite(byWeek) && byWeek>0) return byWeek;
    const global = parseFloat(localStorage.getItem('weeklyBudget'));
    return Number.isFinite(global) && global>0 ? global : 3000;
  }
  function sumPurchasesFor(isoMonday) {
    const key = `purchases_${isoMonday}`;
    try {
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      return Array.isArray(arr) ? arr.reduce((acc, p) => acc + (Number(p.amount)||0), 0) : 0;
    } catch { return 0; }
  }
  function parseAmountInput(str){
    if (!str) return 0;
    // tillat mellomrom, punktum og komma
    const cleaned = String(str).replace(/\s/g,'').replace(',', '.');
    const n = Number(cleaned);
    return Number.isFinite(n) ? n : 0;
  }
  function formatNoNO(n){
    return (Number(n)||0).toLocaleString('no-NO', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  function updateBudgetHint(){
    const amountStr = document.getElementById('amountInput').value;
    const dateISO   = document.getElementById('dateInput').value || isoLocalToday();
    const amount    = parseAmountInput(amountStr);
    const date      = dateFromISOLocal(dateISO);
    const targetWeekISO = (localStorage.getItem('activeWeekISO') || mondayOfLocal(date).toISOString().slice(0,10));

    const total = readWeeklyBudgetFor(targetWeekISO);
    const spent = sumPurchasesFor(targetWeekISO);
    const after = total - (spent + amount); // kan bli negativ
    const ratioAfter = (spent + amount) / (total || 1);

    const hint = document.getElementById('budgetHint');
    let cls = 'budget-ok', text = '';
    if (!amount || amount <= 0){
      text = `Disponibelt: ${formatNoNO(total - spent)} kr`;
    } else if (after < 0){
      cls = 'budget-over';
      text = `Etter lagring: ${formatNoNO(Math.abs(after))} kr over budsjett`;
    } else if (ratioAfter >= 0.9){
      cls = 'budget-warn';
      text = `Etter lagring: ${formatNoNO(after)} kr igjen (n√¶r budsjett)`;
    } else {
      cls = 'budget-ok';
      text = `Etter lagring: ${formatNoNO(after)} kr igjen`;
    }
    hint.className = `budget-hint ${cls}`;
    hint.textContent = text;
  }

  function updateWeekHint(){
    const dateISO = document.getElementById('dateInput').value || isoLocalToday();
    const date = dateFromISOLocal(dateISO);
    const realMon = mondayOfLocal(date);
    const realWeekISO = realMon.toISOString().slice(0,10);
    const pinned = localStorage.getItem('activeWeekISO') || '';
    const mon = pinned ? dateFromISOLocal(pinned) : realMon;
    const sun = new Date(mon); sun.setDate(mon.getDate()+6);

    const weekNo = isoWeekNumber(mon);
    const range = formatRangeNoNO(mon, sun);

    const hint = document.getElementById('weekHint');
    const mismatch = pinned && pinned !== realWeekISO;
    hint.classList.toggle('warn', !!mismatch);
    hint.textContent = mismatch
      ? `Lagrer til Uke ${weekNo} (${range}) ‚Äì aktiv uke er festet`
      : `Lagrer til Uke ${weekNo} (${range})`;
  }

  /* ======================
     Snackbar (Angre)
     ====================== */
  let lastSaved = null; // {weekISO, store, amount, dateISO}
  let snackbarTimer = null;

  function showSnackbar(message="Kj√∏p lagret"){
    const bar = document.getElementById('snackbar');
    document.getElementById('snackbarMsg').textContent = message;
    bar.classList.add('show');
    clearTimeout(snackbarTimer);
    snackbarTimer = setTimeout(()=>{ bar.classList.remove('show'); location.href='app.html'; }, 4000);
  }
  function hideSnackbar(){ const bar = document.getElementById('snackbar'); bar.classList.remove('show'); clearTimeout(snackbarTimer); }

  document.getElementById('undoBtn').addEventListener('click', ()=>{
    if (!lastSaved) return;
    const key = `purchases_${lastSaved.weekISO}`;
    try {
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      // finn siste match (trygt hvis flere like)
      for (let i=arr.length-1;i>=0;i--){
        const p = arr[i];
        if (p && p.store===lastSaved.store && Number(p.amount)===Number(lastSaved.amount) && p.dateISO===lastSaved.dateISO){
          arr.splice(i,1);
          break;
        }
      }
      localStorage.setItem(key, JSON.stringify(arr));
      hideSnackbar();
      // Vis bekreftelse og ikke redirect
      showSnackbar("Angret ‚Äì kj√∏pet er fjernet");
      clearTimeout(snackbarTimer); // ikke auto-redirect etter angre
    } catch {}
  });
  document.getElementById('gotoBtn').addEventListener('click', ()=>{
    location.href = 'app.html';
  });

  /* ======================
     Init UI
     ====================== */
  // Sett dagens dato
  document.getElementById('dateInput').value = isoLocalToday();

  // Husk siste butikk
  (function initStore(){
    const select = document.getElementById('storeInput');
    const last = localStorage.getItem(LAST_STORE_KEY);
    if (last){
      const opt = Array.from(select.options).find(o=>o.value===last);
      if (opt) select.value = last;
    }
    renderStoreChips();
    select.addEventListener('change', ()=>{
      const v = select.value;
      if (v){
        localStorage.setItem(LAST_STORE_KEY, v);
        renderStoreChips();
      }
    });
  })();

  // Bel√∏p: autoformat p√• blur, live budsjettvarsel p√• input
  const amountInput = document.getElementById('amountInput');
  amountInput.addEventListener('input', updateBudgetHint);
  amountInput.addEventListener('blur', ()=>{
    const n = parseAmountInput(amountInput.value);
    if (n>0) amountInput.value = formatNoNO(n);
    else amountInput.value = '';
    updateBudgetHint();
  });
  amountInput.addEventListener('focus', ()=>{
    // fjern tusenskilletegn for enklere redigering
    const n = parseAmountInput(amountInput.value);
    if (n>0) amountInput.value = String(n);
  });

  // Dato: oppdater ukehint + budsjettvarsel
  const dateInput = document.getElementById('dateInput');
  dateInput.addEventListener('change', ()=>{ updateWeekHint(); updateBudgetHint(); });

  // F√∏rste visning
  updateWeekHint();
  updateBudgetHint();

  /* ======================
     Lagring
     ====================== */
  document.getElementById('purchaseForm').addEventListener('submit', (e) => {
    e.preventDefault();

    const saveButton = document.getElementById('saveButton');
    const saveLabel  = document.getElementById('saveButtonText');
    const store = document.getElementById('storeInput').value;
    const amountRaw = document.getElementById('amountInput').value;
    const dateISO = document.getElementById('dateInput').value;

    const amount = parseAmountInput(amountRaw);
    if (!store || !isFinite(amount) || amount <= 0 || !dateISO) return;

    const originalLabel = saveLabel.textContent;
    saveButton.classList.add('saving');
    saveLabel.textContent = 'Lagrer...';

    setTimeout(() => {
      try {
        const date = dateFromISOLocal(dateISO);
        const weekISO = (localStorage.getItem('activeWeekISO') || mondayOfLocal(date).toISOString().slice(0,10));
        const key = `purchases_${weekISO}`;
        const purchases = JSON.parse(localStorage.getItem(key) || '[]');

        const entry = { store, amount: Number(amount.toFixed(2)), dateISO, source: "manual" };
        purchases.push(entry);
        localStorage.setItem(key, JSON.stringify(purchases));

        // Oppdater butikk-statistikk
        incStoreCount(store);
        renderStoreChips();

        // Speil totalbudsjett (for andre sider)
        const wkKey = `weeklyBudget_${weekISO}`;
        const wkBudget = parseFloat(localStorage.getItem(wkKey)) || parseFloat(localStorage.getItem('weeklyBudget')) || 3000;
        localStorage.setItem('budget_total', String(wkBudget));

        // For angre:
        lastSaved = { weekISO, ...entry };
        showSnackbar("Kj√∏p lagret");
      } finally {
        saveButton.classList.remove('saving');
        saveLabel.textContent = originalLabel;
        // ikke redirect umiddelbart ‚Äì snackbar h√•ndterer redirect etter 4s
      }
    }, 200);
  });

  // Tilbake-knapp
  document.getElementById('backButton').addEventListener('click', () => {
    location.href = 'app.html';
  });

  /* ======================
     Element SDK (valgfritt)
     ====================== */
  function adjustColor(color, percent) {
    const num = parseInt(color.replace('#',''), 16);
    const amt = Math.round(2.55 * percent);
    const R = Math.max(0, Math.min(255, (num >> 16) + amt));
    const G = Math.max(0, Math.min(255, (num >> 8 & 0x00FF) + amt));
    const B = Math.max(0, Math.min(255, (num & 0x0000FF) + amt));
    return '#' + (0x1000000 + R*0x10000 + G*0x100 + B).toString(16).slice(1);
  }
  function onConfigChange(config){
    const backgroundColor = config.background_color || defaultConfig.background_color;
    const surfaceColor = config.surface_color || defaultConfig.surface_color;
    const textColor = config.text_color || defaultConfig.text_color;
    const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
    const secondaryTextColor = config.secondary_text_color || defaultConfig.secondary_text_color;
    const customFont = config.font_family || defaultConfig.font_family;
    const baseSize = config.font_size || defaultConfig.font_size;

    document.body.style.background = `linear-gradient(135deg, ${backgroundColor} 0%, ${adjustColor(backgroundColor, -2)} 100%)`;
    document.querySelector('.container').style.background = surfaceColor;

    document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
    document.getElementById('descriptionText').textContent = config.description_text || defaultConfig.description_text;
    document.getElementById('storeLabel').textContent = config.store_label || defaultConfig.store_label;
    document.getElementById('amountLabel').textContent = config.amount_label || defaultConfig.amount_label;
    document.getElementById('dateLabel').textContent = config.date_label || defaultConfig.date_label;
    document.getElementById('saveButtonText').textContent = config.save_button_text || defaultConfig.save_button_text;
    document.getElementById('backButtonText').textContent = config.back_button_text || defaultConfig.back_button_text;

    ['mainTitle','descriptionText'].forEach(id=>{
      const el = document.getElementById(id);
      el.style.fontFamily = `${customFont}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      el.style.color = id==='descriptionText' ? secondaryTextColor : textColor;
      if (id==='mainTitle') el.style.fontSize = `${baseSize * 1.78}px`;
    });

    document.querySelectorAll('.form-input').forEach(input=>{
      input.style.borderColor = adjustColor(primaryActionColor, 60);
      input.style.color = textColor;
      input.style.fontFamily = `${customFont}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
    });

    const saveButton = document.getElementById('saveButton');
    saveButton.style.background = `linear-gradient(135deg, ${primaryActionColor} 0%, ${adjustColor(primaryActionColor, -10)} 100%)`;
    saveButton.style.fontFamily = `${customFont}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
  }
  function mapToCapabilities(config){
    return {
      recolorables:[
        {get:()=>config.background_color||defaultConfig.background_color,set:v=>window.elementSdk?.setConfig({background_color:v})},
        {get:()=>config.surface_color||defaultConfig.surface_color,set:v=>window.elementSdk?.setConfig({surface_color:v})},
        {get:()=>config.text_color||defaultConfig.text_color,set:v=>window.elementSdk?.setConfig({text_color:v})},
        {get:()=>config.primary_action_color||defaultConfig.primary_action_color,set:v=>window.elementSdk?.setConfig({primary_action_color:v})},
        {get:()=>config.secondary_text_color||defaultConfig.secondary_text_color,set:v=>window.elementSdk?.setConfig({secondary_text_color:v})},
      ],
      borderables:[],
      fontEditable:{get:()=>config.font_family||defaultConfig.font_family,set:v=>window.elementSdk?.setConfig({font_family:v})},
      fontSizeable:{get:()=>config.font_size||defaultConfig.font_size,set:v=>window.elementSdk?.setConfig({font_size:v})},
    };
  }
  function mapToEditPanelValues(config){
    return new Map([
      ["main_title", config.main_title || defaultConfig.main_title],
      ["description_text", config.description_text || defaultConfig.description_text],
      ["store_label", config.store_label || defaultConfig.store_label],
      ["amount_label", config.amount_label || defaultConfig.amount_label],
      ["date_label", config.date_label || defaultConfig.date_label],
      ["save_button_text", config.save_button_text || defaultConfig.save_button_text],
      ["back_button_text", config.back_button_text || defaultConfig.back_button_text],
    ]);
  }
  if (window.elementSdk){
    window.elementSdk.init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues });
  }
</script>
</body>
</html>
